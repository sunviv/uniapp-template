import{d as e,r as l,c as a,w as s,g as o,o as t,m as u,N as n,a as i,b as r,e as c,f as d,i as m,h as p,D as v,l as f,n as g,p as _,F as y,k as h,t as b,u as k,G as w}from"./index-BwhScCa-.js";import{c as C,a as V,v as x,m as S,b as $,y as K,f as F,h as I,E as j,F as T,w as z,x as q}from"./wd-icon.yc3zWEZQ.js";import{w as A}from"./wd-popup.B5X6nS8K.js";import{f as B,w as D}from"./wd-datetime-picker.Cx-QMu_N.js";import{u as L,F as M}from"./types.B7qIINKX.js";import{a as O,u as W}from"./useTranslate.B4ZWBcd4.js";import{_ as H}from"./_plugin-vue_export-helper.BCo6x5W8.js";const P=H(e({name:"wd-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...C,customLabelClass:$(""),customValueClass:$(""),customViewClass:$(""),label:String,placeholder:String,disabled:V(!1),readonly:V(!1),loading:V(!1),loadingColor:$("#4D80F0"),title:String,cancelButtonText:String,confirmButtonText:String,required:V(!1),size:String,labelWidth:String,useDefaultSlot:V(!1),useLabelSlot:V(!1),error:V(!1),alignRight:V(!1),beforeConfirm:Function,closeOnClickModal:V(!0),safeAreaInsetBottom:V(!0),ellipsis:V(!1),columnsHeight:S(217),valueKey:$("value"),labelKey:$("label"),modelValue:{type:[String,Number,Array],default:""},columns:{type:Array,default:()=>[]},columnChange:Function,displayFormat:Function,zIndex:S(15),prop:String,rules:x(),immediateChange:V(!1),clearable:V(!1)},emits:["confirm","open","cancel","clear","update:modelValue"],setup(e,{expose:C,emit:V}){const{translate:x}=O("picker"),S=e,$=V,H=l(null),P=L(),E=l(!1),G=l(!1),N=l(""),R=l(""),U=l([]),J=l([]),Q=l(!1),X=l(!1),Y=a(()=>S.loading||E.value);s(()=>S.displayFormat,e=>{e&&q(e),H.value&&0!==H.value.getSelectedIndex().length&&se(S.modelValue)},{immediate:!0,deep:!0}),s(()=>S.modelValue,e=>{R.value=e,se(e)},{deep:!0,immediate:!0}),s(()=>S.columns,e=>{U.value=K(e),J.value=K(e),0===e.length?(R.value=F(S.modelValue)?[]:"",N.value=""):se(S.modelValue)},{deep:!0,immediate:!0}),s(()=>S.columnChange,e=>{e&&q(e)},{deep:!0,immediate:!0});const{parent:Z}=W(M),ee=a(()=>Z&&S.prop&&Z.errorMessages&&Z.errorMessages[S.prop]?Z.errorMessages[S.prop]:""),le=a(()=>{let e=!1;if(Z&&Z.props.rules){const l=Z.props.rules;for(const a in l)Object.prototype.hasOwnProperty.call(l,a)&&a===S.prop&&Array.isArray(l[a])&&(e=l[a].some(e=>e.required))}return S.required||S.rules.some(e=>e.required)||e}),{proxy:ae}=o();function se(e){F(e)&&e.length>0||I(e)&&!F(e)&&""!==e?H.value?n(()=>{re(H.value.getSelects())}):re(function(e){const l=B(S.columns,S.valueKey,S.labelKey);if(0===S.columns.length)return;if(""===e||!I(e)||F(e)&&0===e.length)return;const a=j(e);if(-1===["string","number","boolean","array"].indexOf(a))return[];e=F(e)?e:[e],e=e.slice(0,l.length),0===e.length&&(e=l.map(()=>0));let s=[];e.forEach((e,a)=>{let o=l[a].findIndex(l=>l[S.valueKey].toString()===e.toString());o=-1===o?0:o,s.push(o)});const o=s.map((e,a)=>l[a][e]);if(1===o.length)return o[0];return o}(e)):N.value=""}function oe(){S.disabled||S.readonly||($("open"),G.value=!0,R.value=S.modelValue,U.value=J.value)}function te(){G.value=!1,$("cancel");let e=setTimeout(()=>{clearTimeout(e),I(H.value)&&H.value.resetColumns(J.value)},300)}function ue(){if(Y.value)return;if(Q.value)return void(X.value=!0);const{beforeConfirm:e}=S;e&&q(e)?e(R.value,e=>{e&&ne()},ae.$.exposed):ne()}function ne(){if(Y.value||S.disabled)return void(G.value=!1);const e=H.value.getSelects(),l=H.value.getValues(),a=H.value.getColumnsData();G.value=!1,J.value=K(a),$("update:modelValue",l),re(e),$("confirm",{value:l,selectedItems:e})}function ie({value:e}){R.value=e}function re(e){if(F(e)&&!e.length||!e)return;const{valueKey:l,labelKey:a}=S;N.value=(S.displayFormat||T)(e,{valueKey:l,labelKey:a})}function ce(){}function de(){Q.value=!0}function me(){Q.value=!1,X.value&&(X.value=!1,ue())}t(()=>{se(S.modelValue)}),u(()=>{U.value=K(S.columns),J.value=K(S.columns)});const pe=a(()=>S.clearable&&!S.disabled&&!S.readonly&&N.value.length);function ve(){const e=F(R.value)?[]:"";$("update:modelValue",e),$("clear")}const fe=a(()=>!S.disabled&&!S.readonly&&!pe.value);return C({close:function(){te()},open:function(){oe()},setLoading:function(e){E.value=e}}),(e,l)=>{const a=m;return r(),i(a,{class:g(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${k(P).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`),style:f(e.customStyle)},{default:c(()=>[d(a,{class:"wd-picker__field",onClick:oe},{default:c(()=>[e.useDefaultSlot?p(e.$slots,"default",{key:0},void 0,!0):(r(),i(a,{key:1,class:"wd-picker__cell"},{default:c(()=>[e.label||e.useLabelSlot?(r(),i(a,{key:0,class:g(`wd-picker__label ${e.customLabelClass}  ${le.value?"is-required":""}`),style:f(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")},{default:c(()=>[e.label?(r(),_(y,{key:0},[h(b(e.label),1)],64)):p(e.$slots,"label",{key:1},void 0,!0)]),_:3},8,["class","style"])):v("",!0),d(a,{class:"wd-picker__body"},{default:c(()=>[d(a,{class:"wd-picker__value-wraper"},{default:c(()=>[d(a,{class:g(`wd-picker__value ${e.ellipsis&&"is-ellipsis"} ${e.customValueClass} ${N.value?"":"wd-picker__placeholder"}`)},{default:c(()=>[h(b(N.value?N.value:e.placeholder||k(x)("placeholder")),1)]),_:1},8,["class"]),fe.value?(r(),i(z,{key:0,"custom-class":"wd-picker__arrow",name:"arrow-right"})):pe.value?(r(),i(a,{key:1,onClick:w(ve,["stop"])},{default:c(()=>[d(z,{"custom-class":"wd-picker__clear",name:"error-fill"})]),_:1})):v("",!0)]),_:1}),ee.value?(r(),i(a,{key:0,class:"wd-picker__error-message"},{default:c(()=>[h(b(ee.value),1)]),_:1})):v("",!0)]),_:1})]),_:3}))]),_:3}),d(A,{modelValue:G.value,"onUpdate:modelValue":l[1]||(l[1]=e=>G.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,onClose:te,"custom-class":"wd-picker__popup"},{default:c(()=>[d(a,{class:"wd-picker__wraper"},{default:c(()=>[d(a,{class:"wd-picker__toolbar",onTouchmove:ce},{default:c(()=>[d(a,{class:"wd-picker__action wd-picker__action--cancel",onClick:te},{default:c(()=>[h(b(e.cancelButtonText||k(x)("cancel")),1)]),_:1}),e.title?(r(),i(a,{key:0,class:"wd-picker__title"},{default:c(()=>[h(b(e.title),1)]),_:1})):v("",!0),d(a,{class:g("wd-picker__action "+(Y.value?"is-loading":"")),onClick:ue},{default:c(()=>[h(b(e.confirmButtonText||k(x)("done")),1)]),_:1},8,["class"])]),_:1}),d(D,{ref_key:"pickerViewWd",ref:H,"custom-class":e.customViewClass,modelValue:R.value,"onUpdate:modelValue":l[0]||(l[0]=e=>R.value=e),columns:U.value,loading:Y.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,"immediate-change":e.immediateChange,onChange:ie,onPickstart:de,onPickend:me,"column-change":e.columnChange},null,8,["custom-class","modelValue","columns","loading","loading-color","columns-height","value-key","label-key","immediate-change","column-change"])]),_:1})]),_:1},8,["modelValue","close-on-click-modal","z-index","safe-area-inset-bottom"])]),_:3},8,["class","style"])}}}),[["__scopeId","data-v-d4c54cb0"]]);export{P as _};
